"use strict";!function(t){Array.prototype.some||(Array.prototype.some=function(t){for(var e=Object(this),o=e.length>>>0,r=0;r<o;r++)if(r in e&&t.call(null,e[r],r,e))return!0;return!1}),Object.defineProperty(Array.prototype,"shuffle",{enumerable:!1,value:function(){for(var t,e,o=this.length;o;t=parseInt(Math.random()*o),e=this[--o],this[o]=this[t],this[t]=e);return this}}),t.imageCloudSupported=!0,t.fn.imageCloud=function(e){if(!t.imageCloudSupported)return this;var o={gridSize:8,ellipticity:1,query:'select * from flickr.photos.search(0,150) where group_id="1502528@N22" and sort="interestingness-desc"',flickrSize:"s",photos:!1,photoListType:"flickr",wait:50,beforeImageLoad:function(t,e,o){t.css("opacity",Math.pow(e/o,2)).hide()},imageLoad:function(t,e,o){t.fadeIn(200)},weight:function(t,e,o){var r=5.5*o/43200/e*Math.pow((e-t)/e,2);return r>.1?r:0},onDone:null,shuffle:!0};e&&t.extend(o,e);var r,i,a,n,h,l={flickr:function(e){if(localStorage){var r=localStorage.getItem("ImageCloud:flickr:"+o.query),i=parseInt(localStorage.getItem("ImageCloud:flickr:"+o.query+":timestamp"));if(r&&Date.now()-i<864e5)return void e(JSON.parse(r))}t.getJSON("https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(o.query+' and extras="url_'+o.flickrSize+'"')+"&format=json&diagnostics=true&callback=?",function(t,r){t.query.results&&t.query.results.photo?(localStorage&&(localStorage.setItem("ImageCloud:flickr:"+o.query,JSON.stringify(t.query.results.photo)),localStorage.setItem("ImageCloud:flickr:"+o.query+":timestamp",Date.now().toString())),e(t.query.results.photo)):e(!1)})}},s={flickr:function(t){return{width:t["width_"+o.flickrSize],height:t["height_"+o.flickrSize],photo_url:t["url_"+o.flickrSize],link_url:"//www.flickr.com/photos/"+t.owner+"/"+t.id,title:t.title}}},f=function(t,e,o,n){if(t<0||e<0||t+o>r||e+n>i)return!1;for(var h,l=o;l--;)for(h=n;h--;)if(!a[t+l][e+h])return!1;return!0},u=function(t,e,o,r){for(var i,n=o;n--;)for(i=r;i--;)a[t+n][e+i]=!1};if(l[o.photoListType]&&!o.photos&&o.query){var c=this;return l[o.photoListType](function(t){t&&(o.photos=t,c.imageCloud(o))}),this}return s[o.photoListType]&&t.each(o.photos,function(t,e){o.photos[t]=s[o.photoListType](e)}),o.shuffle&&(o.photos=o.photos.shuffle()),this.each(function(){r=Math.floor(this.offsetWidth/o.gridSize),i=Math.floor(this.offsetHeight/o.gridSize),a=[],h=this.offsetWidth*this.offsetHeight,n=o.photos.length;for(var e,l=t(this),s=r;s--;)for(a[s]=[],e=i;e--;)a[s][e]=!0;l.empty(),clearTimeout(l.data("imageCloud-timer"));var c=0,p=setInterval(function(){if(c>=o.photos.length)return clearTimeout(p),void(o.onDone&&o.onDone());!function(e,a,l){var s=o.weight(l,n,h),c=Math.ceil(a.width*s/o.gridSize),p=Math.ceil(a.height/a.width*c);if(0===c||0===p)return!1;var g,d,m,y=Math.floor(Math.sqrt(r*r+i*i)/o.gridSize)*o.gridSize,S=r+i;for(g=y;g-=o.gridSize;){for(d=S,m=[];d--;)m.push([Math.floor(r/2+(y-g)*Math.cos(d/S*2*Math.PI)-c/2),Math.floor(i/2+(y-g)*o.ellipticity*Math.sin(d/S*2*Math.PI)-p/2)]);if(m.shuffle().some(function(r){if(f(r[0],r[1],c,p)){var i=t("<img />");i.css({width:(c*o.gridSize).toString(10)+"px",height:(p*o.gridSize).toString(10)+"px",left:(r[0]*o.gridSize).toString(10)+"px",top:(r[1]*o.gridSize).toString(10)+"px"}),o.beforeImageLoad(i,g,y,l),i[0].onload=function(){o.imageLoad(i,g,y,l)};var n=t('<a href="'+a.link_url+'" target="_blank" />').append(i);return n.attr("title",a.title),e.append(n),i[0].src=a.photo_url,u(r[0],r[1],c,p),!0}return!1}))return!0}}(l,o.photos[c],c),c++},o.wait);t(this).data("wordCloud-timer",p)})}}(jQuery);